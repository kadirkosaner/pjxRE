:: [System] Wardrobe Test
<<set $wardrobe = $wardrobe || { owned: [], equipped: {}, outfits: [] }>>
<<set $player = $player || { confidence: 0, exhibitionism: 0, corruption: 0, intelligence: 0 }>>

<h1>Wardrobe System Test</h1>
<div style="background:#111; padding:20px; border:1px solid #333;">
    <p>Use this panel to inject test items and manipulate stats for verification.</p>

    <!-- TEST ITEMS DEFINITION -->
    <<set _testItems = [
        /* STYLE: CUTE */
        {
            id: "test_cute_sweater", name: "Pastel Pink Sweater", slot: "top", 
            tags: ["casual", "cute"], looks: 5, quality: "Common", 
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Adorable and cozy!",
            startOwned: true
        },
        {
            id: "test_cute_skirt", name: "Pleated Mini Skirt", slot: "bottom", 
            tags: ["casual", "cute"], looks: 5, quality: "Common", 
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Super cute!",
            startOwned: true
        },
        
        /* STYLE: ELEGANT */
        {
            id: "test_elegant_blouse", name: "Silk Blouse", slot: "top", 
            tags: ["formal", "elegant"], looks: 8, quality: "Rare", 
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Sophisticated and classy.",
            startOwned: true
        },
        {
            id: "test_elegant_pants", name: "Tailored Trousers", slot: "bottom", 
            tags: ["formal", "elegant"], looks: 8, quality: "Rare", 
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Professional elegance.",
            startOwned: true
        },
        
        /* STYLE: PROFESSIONAL */
        {
            id: "test_prof_blazer", name: "Business Blazer", slot: "top",
            tags: ["professional", "formal"], looks: 7, quality: "Rare", 
            image: "assets/content/clothing/tops/crop_sholder.jpg", desc: "Office ready.",
            startOwned: true
        },
        {
            id: "test_prof_skirt", name: "Pencil Skirt", slot: "bottom",
            tags: ["professional", "formal"], looks: 7, quality: "Rare", 
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Business appropriate.",
            startOwned: true
        },
        
        /* STYLE: SEXY */
        {
            id: "test_sexy_top", name: "Lace Crop Top", slot: "top",
            tags: ["sexy", "revealing"], looks: 10, quality: "Premium", 
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Eye-catching and alluring.",
            startOwned: true
        },
        {
            id: "test_sexy_shorts", name: "Booty Shorts", slot: "bottom",
            tags: ["sexy", "daring"], looks: 10, quality: "Premium",
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Barely there.",
            startOwned: true
        },
        
        /* STYLE: SLUTTY */
        {
            id: "test_slutty_mesh", name: "Fishnet Bodysuit", slot: "top",
            tags: ["slutty", "erotic"], looks: 12, quality: "Premium",
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "See-through and scandalous.",
            startOwned: true
        },
        {
            id: "test_slutty_micro", name: "Micro Skirt", slot: "bottom",
            tags: ["slutty", "erotic"], looks: 12, quality: "Premium",
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Impossibly short.",
            startOwned: true
        },
        
        /* STYLE: BIMBO */
        {
            id: "test_bimbo_crop", name: "Hot Pink Tube Top", slot: "top",
            tags: ["bimbo", "lewd"], looks: 15, quality: "Legendary",
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Ultra tight and attention-grabbing.",
            startOwned: true
        },
        {
            id: "test_bimbo_leggings", name: "Shiny Latex Leggings", slot: "bottom",
            tags: ["bimbo", "lewd"], looks: 15, quality: "Legendary",
            image: "assets/content/clothing/tops/crop_black.jpg", desc: "Glossy and ultra-tight.",
            startOwned: true
        }
    ]>>

    <<button "Inject Test Items">>
        /* Ensure categories exist */
        <<set setup.clothingData.tops = setup.clothingData.tops || []>>
        <<set setup.clothingData.bottoms = setup.clothingData.bottoms || []>>
        <<set setup.clothingData.bras = setup.clothingData.bras || []>>

        /* Inject */
        <<run 
            _testItems.forEach(item => {
                let cat = item.slot === 'bra' ? 'bras' : (item.slot === 'bottom' ? 'bottoms' : 'tops');
                
                // Add to Definition if not exists
                if (!setup.clothingData[cat].find(i => i.id === item.id)) {
                    setup.clothingData[cat].push(item);
                }
                
                // Add to Owned
                if (!$wardrobe.owned.includes(item.id)) {
                    $wardrobe.owned.push(item.id);
                }
            });
            // Re-run init to be safe
            setup.initializePlayerWardrobe();
        >>
        <<run window.notifySuccess("Test Items Added! Check Wardrobe.")>>
    <</button>>
    
    <hr style="border-color:#333;">

    <h3>Stat Controls</h3>
    <div style="display:flex; gap:10px; margin-bottom:10px;">
        <span>Confidence: <span id="val-conf">$confidence</span></span>
        <<button "-10">> <<set $confidence to Math.max(0, $confidence - 10)>> <<replace "#val-conf">>$confidence<</replace>> <</button>>
        <<button "+10">> <<set $confidence to Math.min(100, $confidence + 10)>> <<replace "#val-conf">>$confidence<</replace>> <</button>>
        <<button "SET MAX (100)">> <<set $confidence to 100>> <<replace "#val-conf">>$confidence<</replace>> <</button>>
    </div>
    
    <div style="display:flex; gap:10px;">
        <span>Exhibitionism: <span id="val-exp">$exhibitionism</span></span>
        <<button "-10">> <<set $exhibitionism to Math.max(0, $exhibitionism - 10)>> <<replace "#val-exp">>$exhibitionism<</replace>> <</button>>
        <<button "+10">> <<set $exhibitionism to Math.min(100, $exhibitionism + 10)>> <<replace "#val-exp">>$exhibitionism<</replace>> <</button>>
        <<button "SET MAX (100)">> <<set $exhibitionism to 100>> <<replace "#val-exp">>$exhibitionism<</replace>> <</button>>
    </div>

    <h3>Topbar Notification Preview</h3>
    <div id="notif-preview" style="display:flex; flex-wrap:wrap; gap:15px; background:#222; padding:15px; border-radius:8px; margin-bottom:20px; align-items:center;">
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-naked" style="width:32px; height:32px; background-color:#ef4444;" title="Naked (Value 1)"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Naked</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-underwear" style="width:32px; height:32px; background-color:#f97316;" title="Underwear (Value 2)"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Underwear</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-commando" style="width:32px; height:32px; background-color:#f59e0b;" title="Commando (Value 3)"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Commando</span>
        </div>
        
        <!-- Style-based notifications -->
        <div style="width:100%; height:1px; background:#444; margin:5px 0;"></div>
        
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-dress" style="width:32px; height:32px; background-color:#ec4899;" title="Cute Style"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Cute</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-dress" style="width:32px; height:32px; background-color:#a855f7;" title="Elegant Style"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Elegant</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-dress" style="width:32px; height:32px; background-color:#3b82f6;" title="Professional Style"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Professional</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-dress" style="width:32px; height:32px; background-color:#f97316;" title="Sexy Style"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Sexy</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-dress" style="width:32px; height:32px; background-color:#ef4444;" title="Slutty Style"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Slutty</span>
        </div>
        <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="icon-notif icon-dress" style="width:32px; height:32px; background-color:#ec4899;" title="Bimbo Style"></div>
            <span style="font-size:10px; color:#999; margin-top:5px;">Bimbo</span>
        </div>
        
        <div style="margin-left:auto; text-align:right; min-width:150px;">
            <div style="font-weight:bold; color:var(--color-primary);">Current State:</div>
            <div id="current-notif-val" style="font-family:monospace; font-size:18px;">...</div>
            <div id="current-notif-style" style="font-size:12px; color:#888; margin-top:5px;">Style: -</div>
        </div>
    </div>

    <<script>>
        $(document).on(':passagerender', function() {
            setTimeout(function() {
                updateNotificationDisplay();
            }, 100);
        });
        
        function updateNotificationDisplay() {
            if (window.State && window.State.variables.wardrobe) {
                const equipped = window.State.variables.wardrobe.equipped || {};
                const clothingData = window.setup?.clothingData || {};
                const STYLE_TAGS = ['cute', 'elegant', 'professional', 'sexy', 'slutty', 'bimbo'];
                
                // Count equipped items
                let equippedCount = Object.keys(equipped).filter(slot => equipped[slot]).length;
                $('#current-notif-val').text(equippedCount + ' items');
                
                // Detect dominant style
                let styleCounts = {};
                Object.values(equipped).forEach(itemId => {
                    if (!itemId) return;
                    let item = null;
                    for (const category of Object.keys(clothingData)) {
                        const items = clothingData[category] || [];
                        item = items.find(i => i.id === itemId);
                        if (item) break;
                    }
                    if (item && item.tags) {
                        item.tags.forEach(tag => {
                            if (STYLE_TAGS.includes(tag)) {
                                styleCounts[tag] = (styleCounts[tag] || 0) + 1;
                            }
                        });
                    }
                });
                
                let dominant = 'none';
                let max = 0;
                Object.entries(styleCounts).forEach(([style, count]) => {
                    if (count > max) {
                        max = count;
                        dominant = style;
                    }
                });
                
                $('#current-notif-style').text('Style: ' + (dominant !== 'none' ? dominant.toUpperCase() : '-'));
                
                // Debug: Show what topbar would calculate
                const hasTop = equipped.top && equipped.top !== '';
                const hasBottom = equipped.bottom && equipped.bottom !== '';
                const hasDress = equipped.dress && equipped.dress !== '';
                const hasBra = equipped.bra && equipped.bra !== '';
                const hasPanty = equipped.panty && equipped.panty !== '';
                
                const isFullyDressed = hasDress || (hasTop && hasBottom);
                const hasAnyUnderwear = hasBra || hasPanty;
                const isUnderwearOnly = !isFullyDressed && hasAnyUnderwear;
                const isNude = !isFullyDressed && !hasAnyUnderwear;
                const isCommando = isFullyDressed && !hasAnyUnderwear;
                
                let notifType = 'NONE (0)';
                if (isNude) notifType = 'NAKED (1)';
                else if (isUnderwearOnly) notifType = 'UNDERWEAR (2)';
                else if (isCommando) notifType = 'COMMANDO (3)';
                else if (dominant !== 'none') notifType = dominant.toUpperCase() + ' STYLE';
                
                $('#current-notif-val').text(equippedCount + ' items | ' + notifType);
                
                console.log('[Notification Debug]', {
                    equipped,
                    hasTop, hasBottom, hasDress, hasBra, hasPanty,
                    isFullyDressed, hasAnyUnderwear, isUnderwearOnly, isNude, isCommando,
                    dominant,
                    notifType
                });
                
                // Force topbar update
                if (typeof UIBar !== 'undefined' && UIBar.update) {
                    UIBar.update();
                }
            }
        }
        
        window.updateNotificationDisplay = updateNotificationDisplay;
    <</script>>

    <h3>Quick Style Tests</h3>
    <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; margin-bottom:20px;">
        <<button "NAKED">>
            <<set $wardrobe.equipped = {}>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "UNDERWEAR">>
            <<set $wardrobe.equipped = {
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "COMMANDO">>
            <<set $wardrobe.equipped = {
                top: "tshirt_white_owned",
                bottom: "jeans_blue_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "CUTE STYLE">>
            <<set $wardrobe.equipped = {
                top: "test_cute_sweater",
                bottom: "test_cute_skirt",
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "ELEGANT STYLE">>
            <<set $wardrobe.equipped = {
                top: "test_elegant_blouse",
                bottom: "test_elegant_pants",
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "PROFESSIONAL STYLE">>
            <<set $wardrobe.equipped = {
                top: "test_prof_blazer",
                bottom: "test_prof_skirt",
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "SEXY STYLE">>
            <<set $wardrobe.equipped = {
                top: "test_sexy_top",
                bottom: "test_sexy_shorts",
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "SLUTTY STYLE">>
            <<set $wardrobe.equipped = {
                top: "test_slutty_mesh",
                bottom: "test_slutty_micro",
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
        
        <<button "BIMBO STYLE">>
            <<set $wardrobe.equipped = {
                top: "test_bimbo_crop",
                bottom: "test_bimbo_leggings",
                bra: "bra_sport_white_owned",
                panty: "panties_white_owned"
            }>>
            <<run updateNotificationDisplay()>>
        <</button>>
    </div>

    <hr style="border-color:#333;">

    <<button "OPEN WARDROBE">>
        <<wardrobe>>
    <</button>>
    
    <<button "Return to Bedroom">>
        <<goto "fhBedroom">>
    <</button>>

</div>
